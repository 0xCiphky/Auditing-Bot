# Automated Audit Report

## Info

This bot is designed to streamline the auditing process by identifying basic issues in contracts allowing auditors to focus their attention on digging deeper into the codebase and uncovering more complex issues.

Notice: This report may contain some false positives. Check all findings manually to verify them

## **Summary**

| Audit Date      | Total Contracts Scanned | Total Findings | High | Medium | Low | Gas |
| --------------- | ----------------------- | -------------- | ---- | ------ | --- | --- |
| August 13, 2023 | 3                       | 17             | 0    | 0      | 1   | 16  |

## Files analyzed

- 2023-08-verwa/src/GaugeController.sol
- 2023-08-verwa/src/LendingLedger.sol
- 2023-08-verwa/src/VotingEscrow.sol

## **Findings Table**

| Issue Identifier | Issue                                                                                        | Instances |
| ---------------- | -------------------------------------------------------------------------------------------- | --------- |
| -                | **Low Risk**                                                                                 | -         |
| L002             | Unspecific Compiler Version Pragma                                                           | 3         |
| -                | **Gas Optimization**                                                                         | -         |
| G001             | Don't Initialize Variables with Default Value                                                | 11        |
| G003             | Use != 0 instead of > 0 for Unsigned Integer Comparison                                      | 17        |
| G005             | Long Revert Strings                                                                          | 1         |
| G006             | Use Shift Right/Left instead of Division/Multiplication if possible                          | 2         |
| G007             | ++i costs less gas than i++, especially when its used in for-loops (--i/i-- too)             | 4         |
| G008             | Use custom errors rather than revert()/require() strings to save gas                         | 40        |
| G009             | Address 0 check can be done in assembly to save gas                                          | 3         |
| G011             | Functions guaranteed to revert when called by normal users can be marked payable             | 4         |
| G012             | Setting the constructor to payable                                                           | 3         |
| G013             | 10 \*\* 18 can be changed to 1e18 and save some gas                                          | 2         |
| G015             | x += y costs more gas than x = x + y for state variables                                     | 25        |
| G016             | Splitting require() statements that use && saves gas - (saves 8 gas per &&)                  | 4         |
| G017             | ++i/i++ should be unchecked{++i}/unchecked{i++} when it is not possible for them to overflow | 6         |
| G022             | Using private for constants saves gas                                                        | 6         |
| G023             | Using bool for storage incurs overhead                                                       | 6         |
| G023             | Use bytes.concat() instead of abi.encodePacked()                                             | 6         |

## Low Risk - 1 Issues 3 Findings

<details><summary>Low Risk Findings</summary>

---

[**L002] Unspecific Compiler Version Pragma\*\*

**Impact**  
Unspecific compiler version pragma can lead to potential security risks and unexpected behavior when new compiler versions are released.  
**Recommendation**  
It is recommended to use a fixed version pragma for non-library contracts to ensure consistency and maintainability.

<details><summary>View Findings (3)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 2

```sol
pragma solidity ^0.8.16;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L2)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 2

```sol
pragma solidity ^0.8.16;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L2)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 2

```sol
pragma solidity ^0.8.16;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L2)**

</details>

</details>

## Gas Optimization - 16 Issues 140 Findings

<details><summary>Gas Optimization Findings</summary>

---

[**G001] Don't Initialize Variables with Default Value\*\*

**Impact**  
Initializing variables with their default values is redundant and can lead to unnecessary gas consumption.

**Recommendation**  
Avoid initializing state variables with default values.

<details><summary>View Findings (11)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 227

```sol
uint256 old_dt = 0;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L227)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 176

```sol
uint256 blockSlope = 0; // dblock/dt
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L176)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 185

```sol
for (uint256 i = 0; i < 255; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L185)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 433

```sol
uint256 min = 0;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L433)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 436

```sol
for (uint256 i = 0; i < 128; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L436)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 452

```sol
uint256 min = 0;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L452)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 454

```sol
for (uint256 i = 0; i < 128; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L454)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 505

```sol
uint256 dBlock = 0;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L505)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 506

```sol
uint256 dTime = 0;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L506)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 538

```sol
for (uint256 i = 0; i < 255; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L538)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 585

```sol
uint256 dTime = 0;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L585)**

</details>

---

[**G003] Use != 0 instead of > 0 for Unsigned Integer Comparison\*\*

**Impact**  
When dealing with unsigned integer types, comparisons using != 0 are cheaper in terms of gas than using > 0.

**Recommendation**  
For unsigned integer comparisons, consider using != 0 instead of > 0.

<details><summary>View Findings (17)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 93

```sol
if (t > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L93)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 155

```sol
if (total_weight > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L155)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 110

```sol
require(lendingMarketTotalBalanceEpoch[_market] > 0, "No deposits for this market");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L110)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 122

```sol
require(lendingMarketBalancesEpoch[_market][_lender] > 0, "No deposits for this lender in this market");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L122)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 159

```sol
require(userLastClaimed > 0, "No deposits for this user");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L159)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 178

```sol
if (cantoToSend > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L178)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 129

```sol
if (_oldLocked.end > block.timestamp && _oldLocked.delegated > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L129)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 133

```sol
if (_newLocked.end > block.timestamp && _newLocked.delegated > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L133)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 167

```sol
if (epoch > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L167)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 272

```sol
require(_value > 0, "Only non zero amount");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L272)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 291

```sol
require(_value > 0, "Only non zero amount");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L291)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 293

```sol
require(locked_.amount > 0, "No lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L293)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 314

```sol
require(locked_.amount > 0, "Delegatee has no lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L314)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 329

```sol
require(locked_.amount > 0, "No lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L329)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 359

```sol
require(locked_.amount > 0, "No lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L359)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 382

```sol
require(toLocked.amount > 0, "Delegatee has no lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L382)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 405

```sol
if (newLocked.amount > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L405)**

</details>

---

[**G005] Long Revert Strings\*\*

**Impact**  
For the output on a require, each extra memory word of bytes past the original 32 incurs an MSTORE operation which costs 3 gas.

**Recommendation**  
Use a shorter revert string

<details><summary>View Findings (1)</summary>

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 122

```sol
require(lendingMarketBalancesEpoch[_market][_lender] > 0, "No deposits for this lender in this market");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L122)**

</details>

---

[**G006] Use Shift Right/Left instead of Division/Multiplication if possible\*\*

**Impact**  
Using shift operations instead of division or multiplication can save gas when dealing with powers of two.

**Recommendation**  
Consider using shift operations for these cases.

<details><summary>View Findings (2)</summary>

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 438

```sol
uint256 mid = (min + max + 1) / 2;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L438)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 458

```sol
uint256 mid = (min + max + 1) / 2;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L458)**

</details>

---

[**G007] ++i costs less gas than i++, especially when its used in for-loops (--i/i-- too)\*\*

**Impact**  
Using ++i or --i (pre-increment/decrement) is generally more gas-efficient than using i++ or i--.

**Recommendation**  
Use pre-increment/decrement

<details><summary>View Findings (4)</summary>

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 185

```sol
for (uint256 i = 0; i < 255; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L185)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 436

```sol
for (uint256 i = 0; i < 128; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L436)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 454

```sol
for (uint256 i = 0; i < 128; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L454)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 538

```sol
for (uint256 i = 0; i < 255; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L538)**

</details>

---

[**G008] Use custom errors rather than revert()/require() strings to save gas\*\*

**Impact**  
From Solidity version 0.8.4 onwards, custom errors can be used instead of revert() and require() strings to save gas. Custom errors save approximately 50 gas each time they are hit, by avoiding the need to allocate and store the revert string.

**Recommendation**  
Use custom errors

<details><summary>View Findings (40)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 51

```sol
require(msg.sender == governance);
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L51)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 119

```sol
require(!isValidGauge[_gauge], "Gauge already exists");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L119)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 128

```sol
require(isValidGauge[_gauge], "Invalid gauge address");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L128)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 212

```sol
require(_user_weight >= 0 && _user_weight <= 10_000, "Invalid user weight");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L212)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 213

```sol
require(isValidGauge[_gauge_addr], "Invalid gauge address");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L213)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 221

```sol
require(slope_ >= 0, "Invalid slope");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L221)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 225

```sol
require(lock_end > next_time, "Lock expires too soon");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L225)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 241

```sol
require(power_used >= 0 && power_used <= 10_000, "Used too much power");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L241)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 37

```sol
require(_timestamp % WEEK == 0 || _timestamp == type(uint256).max, "Invalid timestamp");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L37)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 42

```sol
require(msg.sender == governance);
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L42)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 110

```sol
require(lendingMarketTotalBalanceEpoch[_market] > 0, "No deposits for this market");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L110)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 122

```sol
require(lendingMarketBalancesEpoch[_market][_lender] > 0, "No deposits for this lender in this market");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L122)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 131

```sol
require(lendingMarketWhitelist[lendingMarket], "Market not whitelisted");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L131)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 136

```sol
require(updatedLenderBalance >= 0, "Lender balance underflow"); // Sanity check performed here, but the market should ensure that this never happens
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L136)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 141

```sol
require(updatedMarketBalance >= 0, "Market balance underflow"); // Sanity check performed here, but the market should ensure that this never happens
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L141)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 159

```sol
require(userLastClaimed > 0, "No deposits for this user");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L159)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 172

```sol
require(ri.set, "Reward not set yet"); // Can only claim for epochs where rewards are set, even if it is set to 0
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L172)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 180

```sol
require(success, "Failed to send CANTO");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L180)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 195

```sol
require(!ri.set, "Rewards already set");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L195)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 205

```sol
require(lendingMarketWhitelist[_market] != _isWhiteListed, "No change");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L205)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 272

```sol
require(_value > 0, "Only non zero amount");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L272)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 273

```sol
require(msg.value == _value, "Invalid value");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L273)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 274

```sol
require(locked_.amount == 0, "Lock exists");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L274)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 291

```sol
require(_value > 0, "Only non zero amount");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L291)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 292

```sol
require(msg.value == _value, "Invalid value");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L292)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 293

```sol
require(locked_.amount > 0, "No lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L293)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 294

```sol
require(locked_.end > block.timestamp, "Lock expired");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L294)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 314

```sol
require(locked_.amount > 0, "Delegatee has no lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L314)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 315

```sol
require(locked_.end > block.timestamp, "Delegatee lock expired");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L315)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 329

```sol
require(locked_.amount > 0, "No lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L329)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 330

```sol
require(locked_.end <= block.timestamp, "Lock not expired");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L330)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 331

```sol
require(locked_.delegatee == msg.sender, "Lock delegated");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L331)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 347

```sol
require(success, "Failed to send CANTO");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L347)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 359

```sol
require(locked_.amount > 0, "No lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L359)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 360

```sol
require(locked_.delegatee != _addr, "Already delegated");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L360)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 382

```sol
require(toLocked.amount > 0, "Delegatee has no lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L382)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 383

```sol
require(toLocked.end > block.timestamp, "Delegatee lock expired");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L383)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 384

```sol
require(toLocked.end >= fromLocked.end, "Only delegate to longer lock");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L384)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 488

```sol
require(_blockNumber <= block.number, "Only past block number");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L488)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 573

```sol
require(_blockNumber <= block.number, "Only past block number");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L573)**

</details>

---

[**G009] Address 0 check can be done in assembly to save gas\*\*

**Impact**  
This check can be done more efficiently using inline assembly.

**Recommendation**  
Use inline assembly

<details><summary>View Findings (3)</summary>

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 126

```sol
if (_addr != address(0)) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L126)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 223

```sol
if (_addr != address(0)) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L223)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 239

```sol
if (_addr != address(0)) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L239)**

</details>

---

[**G011] Functions guaranteed to revert when called by normal users can be marked payable\*\*

**Impact**  
Marking the function as payable will lower the gas cost for legitimate callers because the compiler will not include checks for whether a payment was provided.

**Recommendation**  
You can mark the function as payable to reduce gas costs.

<details><summary>View Findings (4)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 118

```sol
function add_gauge(address _gauge) external onlyGovernance {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L118)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 127

```sol
function remove_gauge(address _gauge) external onlyGovernance {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L127)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 204

```sol
function change_gauge_weight(address _gauge, uint256 _weight) public onlyGovernance {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L204)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 204

```sol
function whiteListLendingMarket(address _market, bool _isWhiteListed) external onlyGovernance {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L204)**

</details>

---

[**G012] Setting the constructor to payable\*\*

**Impact**  
You can cut out 10 opcodes in the creation-time EVM bytecode if you declare a constructor payable.

**Recommendation**  
mark the constructor as payable to reduce gas costs

<details><summary>View Findings (3)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 57

```sol
constructor(address _votingEscrow, address _governance) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L57)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 46

```sol
constructor(address _gaugeController, address _governance) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L46)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 72

```sol
constructor(string memory _name, string memory _symbol) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L72)**

</details>

---

[**G013] 10 ** 18 can be changed to 1e18 and save some gas**

**Impact**  
10 \*\* 18 can be changed to 1e18 to avoid unnecessary arithmetic operation and save gas.

**Recommendation**  
use 1e18 to reduce gas costs

<details><summary>View Findings (2)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 17

```sol
uint256 public constant MULTIPLIER = 10**18;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L17)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 33

```sol
uint256 public constant MULTIPLIER = 10**18;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L33)**

</details>

---

[**G015] x += y costs more gas than x = x + y for state variables\*\*

**Impact**  
Using x += y for state variables costs more gas than using x = x + y. This is because the += and -= operators require extra gas for updating the state variable compared to the standard assignment operator.

**Recommendation**  
You can use x = x + y to reduce gas costs

<details><summary>View Findings (25)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 71

```sol
t += WEEK;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L71)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 74

```sol
pt.bias -= d_bias;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L74)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 76

```sol
pt.slope -= d_slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L76)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 97

```sol
t += WEEK;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L97)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 100

```sol
pt.bias -= d_bias;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L100)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 102

```sol
pt.slope -= d_slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L102)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 260

```sol
points_weight[_gauge_addr][next_time].slope += new_slope.slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L260)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 261

```sol
points_sum[next_time].slope += new_slope.slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L261)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 265

```sol
changes_weight[_gauge_addr][old_slope.end] -= old_slope.slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L265)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 266

```sol
changes_sum[old_slope.end] -= old_slope.slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L266)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 269

```sol
changes_weight[_gauge_addr][new_slope.end] += new_slope.slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L269)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 270

```sol
changes_sum[new_slope.end] += new_slope.slope;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L270)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 71

```sol
for (uint256 i = lastUserUpdateEpoch; i <= updateUntilEpoch; i += WEEK) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L71)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 92

```sol
for (uint256 i = lastMarketUpdateEpoch; i <= updateUntilEpoch; i += WEEK) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L92)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 168

```sol
for (uint256 i = claimStart; i <= claimEnd; i += WEEK) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L168)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 174

```sol
cantoToSend += (marketWeight * userBalance * ri.amount) / (1e18 * marketBalance); // (marketWeight / 1e18) * (userBalance / marketBalance) * ri.amount;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L174)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 193

```sol
for (uint256 i = _fromEpoch; i <= _toEpoch; i += WEEK) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L193)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 276

```sol
locked_.amount += int128(int256(_value));
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L276)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 278

```sol
locked_.delegated += int128(int256(_value));
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L278)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 300

```sol
newLocked.amount += int128(int256(_value));
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L300)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 305

```sol
newLocked.delegated += int128(int256(_value));
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L305)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 317

```sol
newLocked.delegated += int128(int256(_value));
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L317)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 337

```sol
newLocked.delegated -= int128(int256(amountToSend));
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L337)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 398

```sol
newLocked.delegated += value;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L398)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 401

```sol
newLocked.delegated -= value;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L401)**

</details>

---

[**G016] Splitting require() statements that use && saves gas - (saves 8 gas per &&)\*\*

**Impact**  
By using multiple require() statements with one condition per require() statement, you can save 8 gas per &&. The gas difference is only realized if the revert condition is met.

**Recommendation**  
You can split the require() statements to save gas

<details><summary>View Findings (4)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 212

```sol
require(_user_weight >= 0 && _user_weight <= 10_000, "Invalid user weight");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L212)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 241

```sol
require(power_used >= 0 && power_used <= 10_000, "Used too much power");
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L241)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 129

```sol
if (_oldLocked.end > block.timestamp && _oldLocked.delegated > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L129)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 133

```sol
if (_newLocked.end > block.timestamp && _newLocked.delegated > 0) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L133)**

</details>

---

[**G017] ++i/i++ should be unchecked{++i}/unchecked{i++} when it is not possible for them to overflow\*\*

**Impact**  
When using Solidity version 0.8.0 or higher, use the unchecked keyword with ++i or i++ when it is not possible for them to overflow. This can save 30-40 gas per loop.

**Recommendation**  
use the unchecked keyword when it is not possible for the counter to overflow

<details><summary>View Findings (6)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 69

```sol
for (uint256 i; i < 500; ++i) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L69)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 95

```sol
for (uint256 i; i < 500; ++i) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L95)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 185

```sol
for (uint256 i = 0; i < 255; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L185)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 436

```sol
for (uint256 i = 0; i < 128; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L436)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 454

```sol
for (uint256 i = 0; i < 128; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L454)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 538

```sol
for (uint256 i = 0; i < 255; i++) {
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L538)**

</details>

---

[**G022] Using private for constants saves gas\*\*

**Impact**  
Using public or internal for constants may increase deployment gas costs due to the compiler's necessity to create non-payable getter functions. Additionally, it requires storing the bytes of the value outside of where it's used and adding another entry to the method ID table.

**Recommendation**  
To optimize gas, consider declaring constants with the `private` visibility.

<details><summary>View Findings (6)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 16

```sol
uint256 public constant WEEK = 7 days;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L16)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 17

```sol
uint256 public constant MULTIPLIER = 10**18;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L17)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 10

```sol
uint256 public constant WEEK = 7 days;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L10)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 31

```sol
uint256 public constant WEEK = 7 days;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L31)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 32

```sol
uint256 public constant LOCKTIME = 1825 days;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L32)**

**File:** 2023-08-verwa/src/VotingEscrow.sol  
**Line Number:** 33

```sol
uint256 public constant MULTIPLIER = 10**18;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/VotingEscrow.sol#L33)**

</details>

---

[**G023] Using bool for storage incurs overhead\*\*

**Impact**  
Using the `bool` data type for storage can result in extra gas costs, especially when altering the boolean's state multiple times. Specifically, changing a `bool` from `false` to `true` after it was previously set to `true` can incur a `Gsset` charge of 20000 gas.

**Recommendation**  
Consider using `uint256` values such as `uint256(1)` for `true` and `uint256(0)` for `false` to avoid these gas overheads. See [source](#) for more information.

<details><summary>View Findings (6)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 26

```sol
mapping(address => bool) public isValidGauge;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L26)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 26

```sol
mapping(address => bool) public isValidGauge;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L26)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 15

```sol
mapping(address => bool) public lendingMarketWhitelist;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L15)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 29

```sol
bool set;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L29)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 15

```sol
mapping(address => bool) public lendingMarketWhitelist;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L15)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 29

```sol
bool set;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L29)**

</details>

---

[**G023] Use bytes.concat() instead of abi.encodePacked()\*\*

**Impact**  
Starting from Solidity version 0.8.4, it is recommended to use bytes.concat() for appending bytes instead of abi.encodePacked() for better readability and simplicity.  
**Recommendation**
Replace abi.encodePacked() with bytes.concat()

<details><summary>View Findings (6)</summary>

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 26

```sol
mapping(address => bool) public isValidGauge;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L26)**

**File:** 2023-08-verwa/src/GaugeController.sol  
**Line Number:** 26

```sol
mapping(address => bool) public isValidGauge;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/GaugeController.sol#L26)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 15

```sol
mapping(address => bool) public lendingMarketWhitelist;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L15)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 29

```sol
bool set;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L29)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 15

```sol
mapping(address => bool) public lendingMarketWhitelist;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L15)**

**File:** 2023-08-verwa/src/LendingLedger.sol  
**Line Number:** 29

```sol
bool set;
```

**[Link to Code](https://github.com/code-423n4/2023-08-verwa/blob/main/src/LendingLedger.sol#L29)**

</details>

</details>
